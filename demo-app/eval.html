<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LLM Doc Highlighting - Eval Review</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./eval.css" />
  </head>
  <body>
    <div class="wrap eval-wrap">
      <aside class="panel">
        <div class="panel-header">
          <div class="kicker">Evaluation</div>
          <h1>Eval Review</h1>
          <p class="muted">
            Review the selected run, pick a document, and inspect a data point. The viewer shows ground truth
            vs A/B method boxes.
          </p>
          <a class="link" href="/demo.html">Back to demo</a>
          <a class="link" href="/">Back to landing</a>
        </div>

        <div class="card">
          <div class="label">A/B summary</div>
          <div class="ab-status">
            <span id="abStatusChip" class="badge">-</span>
            <span id="abStatusNote" class="muted">Select a data point to see alignment.</span>
          </div>
          <div class="ab-grid">
            <div class="ab-head">Method</div>
            <div class="ab-head">IoU</div>
            <div class="ab-head">Precision</div>
            <div class="ab-head">Recall</div>
            <div class="ab-head">Pass2</div>

            <div class="ab-label">Raw + Fuzzy</div>
            <div id="metricRawIou" class="badge">-</div>
            <div id="metricRawPrecision" class="badge">-</div>
            <div id="metricRawRecall" class="badge">-</div>
            <div id="metricRawPass2" class="badge">-</div>

            <div class="ab-label">Indexed</div>
            <div id="metricIndexedIou" class="badge">-</div>
            <div id="metricIndexedPrecision" class="badge">-</div>
            <div id="metricIndexedRecall" class="badge">-</div>
            <div id="metricIndexedPass2" class="badge">-</div>
          </div>
        </div>

        <div class="card">
          <div class="label">Selected data point</div>
          <div class="eval-block">
            <div class="label">Field label</div>
            <div id="evalFieldLabel" class="answer">-</div>
          </div>
          <div class="eval-block">
            <div class="label">Review status</div>
            <div id="fieldReviewStatus" class="answer">-</div>
          </div>
          <div class="eval-block">
            <div class="label label-row">
              <span>Expected value (ground truth)</span>
              <div class="label-actions">
                <div class="control tip" data-tip="Pick dataset GT when saved">
                  <span class="control-icon" aria-hidden="true">
                    <svg class="icon" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="8"></circle>
                      <circle cx="12" cy="12" r="2"></circle>
                    </svg>
                  </span>
                  <label class="gt-pick" title="Use dataset GT">
                    <input type="radio" name="gtPick" value="dataset" />
                    <span class="gt-pick-dot" aria-label="Use dataset GT"></span>
                  </label>
                </div>
                <div class="control tip" data-tip="Show or hide GT boxes">
                  <span class="control-icon" aria-hidden="true">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </span>
                  <label class="switch">
                    <input id="showGt" type="checkbox" checked />
                    <span class="slider"></span>
                  </label>
                </div>
                <span id="gtStatusChip" class="badge">-</span>
              </div>
            </div>
            <button id="evalExpectedValue" class="answer answer-link" type="button" data-focus="gt">-</button>
          </div>
          <div class="eval-block">
            <div class="label label-row">
              <span>Raw + Fuzzy answer</span>
              <div class="label-actions">
                <div class="control tip" data-tip="Pick Raw + Fuzzy as GT when saved">
                  <span class="control-icon" aria-hidden="true">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M4 7h16"></path>
                      <path d="M4 12h16"></path>
                      <path d="M4 17h10"></path>
                    </svg>
                  </span>
                  <label class="gt-pick" title="Use Raw + Fuzzy as GT">
                    <input type="radio" name="gtPick" value="raw" />
                    <span class="gt-pick-dot" aria-label="Use Raw + Fuzzy as GT"></span>
                  </label>
                </div>
                <div class="control tip" data-tip="Show or hide Raw + Fuzzy boxes">
                  <span class="control-icon" aria-hidden="true">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </span>
                  <label class="switch">
                    <input id="showRaw" type="checkbox" checked />
                    <span class="slider"></span>
                  </label>
                </div>
                <span class="badge badge-spacer" aria-hidden="true">-</span>
              </div>
            </div>
            <button id="evalAnswerRaw" class="answer answer-link" type="button" data-focus="raw">-</button>
          </div>
          <div class="eval-block">
            <div class="label label-row">
              <span>Indexed answer</span>
              <div class="label-actions">
                <div class="control tip" data-tip="Pick Indexed as GT when saved">
                  <span class="control-icon" aria-hidden="true">
                    <svg class="icon" viewBox="0 0 24 24">
                      <rect x="4" y="5" width="6" height="6"></rect>
                      <rect x="14" y="5" width="6" height="6"></rect>
                      <rect x="4" y="13" width="6" height="6"></rect>
                      <rect x="14" y="13" width="6" height="6"></rect>
                    </svg>
                  </span>
                  <label class="gt-pick" title="Use Indexed as GT">
                    <input type="radio" name="gtPick" value="indexed" />
                    <span class="gt-pick-dot" aria-label="Use Indexed as GT"></span>
                  </label>
                </div>
                <div class="control tip" data-tip="Show or hide Indexed boxes">
                  <span class="control-icon" aria-hidden="true">
                    <svg class="icon" viewBox="0 0 24 24">
                      <path d="M2 12s4-6 10-6 10 6 10 6-4 6-10 6S2 12 2 12z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </span>
                  <label class="switch">
                    <input id="showIndexed" type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </div>
                <span class="badge badge-spacer" aria-hidden="true">-</span>
              </div>
            </div>
            <button id="evalAnswerIndexed" class="answer answer-link" type="button" data-focus="indexed">-</button>
          </div>
        </div>

        <div class="card">
          <div class="label">GT decisions</div>
          <div class="gt-status">
            <span id="gtStatusBadge" class="badge">-</span>
            <span id="gtStatusNote" class="muted">Select a data point to review GT.</span>
          </div>
          <div id="gtEmptyState" class="gt-empty">
            <div class="muted">Keep dataset GT and mark this field reviewed.</div>
            <button id="gtMarkReviewedBtn" class="primary" type="button">
              Mark reviewed (keep dataset GT)
            </button>
          </div>
          <div class="gt-actions">
            <div class="gt-choice">
              <div class="muted">Pick the GT value using the circles next to each answer.</div>
              <label class="gt-option danger">
                <input id="gtExclude" type="checkbox" />
                <span>Both wrong (exclude)</span>
              </label>
            </div>
            <div class="row note-row">
              <div class="label">Decision note (optional)</div>
              <button id="toggleGtNote" type="button" class="ghost">Add note</button>
            </div>
            <div id="gtNoteWrap" class="note-wrap collapsed">
              <textarea id="gtNote" rows="2" placeholder="Why this decision?"></textarea>
            </div>
            <div class="btns">
              <button id="gtApplyBtn" class="primary" type="button">Apply decision</button>
            </div>
          </div>
          <div id="gtExcludedCount" class="muted">Excluded in this run: -</div>
        </div>

      </aside>

      <main class="viewer viewer-stack">
        <div class="viewer-top">
          <div class="card">
            <div class="label">Browse</div>
            <div class="browse-row">
              <div class="browse-field browse-search collapsed" id="browseSearch">
                <label for="docSearch">Search</label>
                <div class="search-control">
                  <button id="toggleSearch" type="button">Search</button>
                  <input id="docSearch" type="text" placeholder="Search by doc id..." />
                </div>
              </div>
              <div class="browse-field">
                <label for="docSelect">Document</label>
                <select id="docSelect">
                  <option value="">Select a run first</option>
                </select>
              </div>
              <div class="browse-field">
                <label for="exampleSelect">Data point</label>
                <select id="exampleSelect">
                  <option value="">Select a document first</option>
                </select>
              </div>
              <div class="browse-field browse-status">
                <div class="label">Review</div>
                <div id="docReviewStatus" class="muted">-</div>
                <div id="docReviewCounts" class="muted">-</div>
              </div>
              <div class="browse-field browse-actions">
                <div class="label">Navigate</div>
                <div class="btns">
                  <button id="prevSample">Previous</button>
                  <button id="nextSample">Next</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="viewer-panel">
          <div id="wv"></div>
        </div>
      </main>
    </div>

    <div class="eval-footer">
      <div class="footer-panel">
        <div class="footer-block">
          <div class="label">Legend</div>
          <div class="legend">
            <div class="legend-row">
              <span class="swatch method-ab"></span>
              <span class="legend-label">A/B overlays (joint)</span>
              <div class="legend-controls">
                <label class="switch" title="Indeterminate means only A or B is selected">
                  <input id="toggleAB" type="checkbox" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
            <div class="legend-row">
              <span class="swatch method-ab"></span>
              <span class="legend-label">Merged line view (visual only)</span>
              <div class="legend-controls">
                <label class="switch">
                  <input id="showMerged" type="checkbox" />
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
          <p class="muted">
            These are hollow boxes for clarity; overlap can be visually compared by alignment.
            When A and B are both on, we render an amber A/B overlay instead of separate red/blue boxes.
            The A/B joint control shows a partial state when only one method is enabled.
          </p>
        </div>
        <div class="footer-block">
          <div class="label">Run</div>
          <div class="row">
            <label for="evalRunSelect">Eval run</label>
            <select id="evalRunSelect">
              <option value="">Loading runs...</option>
            </select>
          </div>
          <div class="row">
            <label>Selected run</label>
            <div id="evalRunName" class="answer">-</div>
          </div>
          <div class="muted" id="evalRunMeta">-</div>
          <div class="row">
            <a class="link" href="/stats.html">Open stats</a>
          </div>
        </div>
        <div class="footer-block">
          <div class="label">Scoring definition</div>
          <p class="muted">
            Scores use strict word-box overlap (IoU threshold 0.5) on deduped boxes. Overlays are visual and
            can look identical even when strict scores differ. The merged-line toggle only changes display.
            Samples marked as excluded are skipped in scoring.
          </p>
        </div>
      </div>
    </div>

    <script src="/webviewer/webviewer.min.js"></script>
    <script src="./eval.js"></script>
  </body>
</html>
